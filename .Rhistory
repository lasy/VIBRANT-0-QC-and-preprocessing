#| fig-width: 16
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(), col = standard_category) +
geom_point() +
facet_grid(plate_nb ~ .feature)
#| fig-width: 16
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(), col = standard_category) +
geom_point() +
facet_grid(plate_nb ~ .feature)
#| fig-width: 16
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(), col = standard_category) +
geom_point() +
facet_grid(plate_nb ~ .feature) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(), col = standard_category) +
geom_point() +
facet_grid(plate_nb ~ .feature) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_point() +
facet_grid(plate_nb ~ .feature) +
scale_alpha_discrete(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
raw |>
as_tibble() |>
filter(sample_type %in% c("Sample", "Standard")) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_point() +
facet_grid(plate_nb ~ .feature) +
scale_alpha_manual(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
raw@metadata$standards |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10"))
raw@metadata$standards |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |> select(.feature) |> distinct()
raw@metadata$standards |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature, plate_nb) |>
distinct()
raw@metadata$standards |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature, plate_nb) |>
distinct() |> select(.feature) |> distinct()
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature, plate_nb) |>
distinct()
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature, plate_nb) |>
distinct() |> select(.feature) |> distinct()
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
features_with_S9_or_S10_as_LLOQ <-
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
#| fig-width: 20
#| fig-height: 15
features_with_S9_or_S10_as_LLOQ <-
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
raw |>
as_tibble() |>
filter(
sample_type %in% c("Sample", "Standard"),
.feature %in% features_with_S9_or_S10_as_LLOQ,
) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_point() +
facet_grid(plate_nb ~ .feature) +
scale_alpha_manual(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
features_with_S9_or_S10_as_LLOQ <-
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
raw |>
as_tibble() |>
filter(
sample_type %in% c("Sample", "Standard"),
.feature %in% features_with_S9_or_S10_as_LLOQ,
) |>
select(plate_nb, .sample, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
mutate(
sample_label =
case_when(
sample_type == "Standard" ~ sample_id |> str_remove("S"),
TRUE ~ "."
)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_text(aes(label = sample_label)) +
facet_grid(plate_nb ~ .feature) +
scale_alpha_manual(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
features_with_S9_or_S10_as_LLOQ <-
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
raw |>
as_tibble() |>
filter(
sample_type %in% c("Sample", "Standard"),
.feature %in% features_with_S9_or_S10_as_LLOQ,
) |>
select(plate_nb, .sample, sample_id, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
mutate(
sample_label =
case_when(
sample_type == "Standard" ~ sample_id |> str_remove("S"),
TRUE ~ "."
)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_text(aes(label = sample_label)) +
facet_grid(plate_nb ~ .feature) +
scale_alpha_manual(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
#| fig-width: 20
#| fig-height: 15
features_with_S9_or_S10_as_LLOQ <-
raw@metadata$standards |>
ungroup() |>
filter(standard_category == "LLOQ") |>
filter(sample_id %in% c("S9", "S10")) |>
select(.feature) |>
distinct() |>
pull(.feature)
raw |>
as_tibble() |>
filter(
sample_type %in% c("Sample", "Standard"),
.feature %in% features_with_S9_or_S10_as_LLOQ,
) |>
select(plate_nb, .sample, sample_id, .feature, sample_type, FI, FI_wo_background, conc, value_type) |>
left_join(
raw@metadata$standards |>
select(plate_nb, .feature, .sample, standard_category) |>
distinct(),
by = join_by(plate_nb, .sample, .feature)
) |>
mutate(
sample_label =
case_when(
sample_type == "Standard" ~ sample_id |> str_remove("S"),
TRUE ~ "o"
)
) |>
ggplot() +
aes(x = sample_type, y = FI_wo_background |> asinh(),
col = standard_category, alpha = sample_type) +
geom_text(aes(label = sample_label)) +
facet_grid(plate_nb ~ .feature) +
scale_alpha_manual(values = c(0.1, 0.8)) +
theme(strip.text.x = element_text(angle = 90, hjust = 0, vjust = 0.5))
library(tidyverse)
library(magrittr)
library(gt)
library(patchwork)
library(SummarizedExperiment)
library(tidySummarizedExperiment)
#| warning: false
library(tidyverse)
library(magrittr)
library(gt)
library(patchwork)
library(SummarizedExperiment)
library(tidySummarizedExperiment)
tmp <- fs::dir_map("R scripts mg/", source)
tmp <- fs::dir_map("R scripts/", source)
getwd()
stop(
"Hello new script runner!\n\t
We do not know you or your machine yet, so we do not know where the VIBRANT Dropbox is on your computer. \n\t
You can easily fix that by opening the `R scripts/VIBRANT_Dropbox_dir/R` file and modify the `VIBRANT_Dropbox_dir` function so that it returns the right path.
")
Untitled
stop(
"
Hello new script runner!\t
We do not know you or your machine yet, so we do not know where the VIBRANT Dropbox is on your computer. \t
You can easily fix that by opening the `R scripts/VIBRANT_Dropbox_dir/R` file and modify the `VIBRANT_Dropbox_dir` function so that it returns the right path.
")
#| warning: false
library(tidyverse)
library(magrittr)
library(gt)
library(patchwork)
library(SummarizedExperiment)
library(tidySummarizedExperiment)
# tmp <- fs::dir_map("R scripts mg/", source)
tmp <- fs::dir_map("R scripts/", source)
theme_set(theme_light())
VIBRANT_dropbox <- VIBRANT_dropbox_dir()
tmp <- fs::dir_map("R scripts/", source)
tmp
VIBRANT_dropbox <- VIBRANT_dropbox_dir()
VIBRANT_dropbox <- VIBRANT_Dropbox_dir()
VIBRANT_dropbox
source("~/Documents/Work/Academia/Research/Projects/01. VIBRANT/VIBRANT-QC-and-preprocessing/R scripts/get_VIBRANT_Dropbox_dir.R")
VIBRANT_dropbox <- get_VIBRANT_Dropbox_dir()
VIBRANT_dropbox
VIBRANT_dropbox <- get_VIBRANT_Dropbox_dir()
mg_dir <- str_c(VIBRANT_dropbox, "13_VIBRANT Metagenomics/")
mg_dir |> list.files()
(str_detect(getwd(), "laurasymul"))
data_dir <- "/Users/laurasymul/OneDrive - UCL/Academia/Research/VIBRANT data UCLouvain/"
data_dir <- data_dir |> str_c("simulated data/")
data_dir
data_dir <- fs::dir_ls(data_dir) |> sort(decreasing = TRUE) |> magrittr::extract(1) |> str_c("/")
data_dir
simulated_data_dir <- get_simulated_data_dir()
source("~/Documents/Work/Academia/Research/Projects/01. VIBRANT/VIBRANT-QC-and-preprocessing/R scripts/get_simulated_data_dir.R")
simulated_data_dir <- get_simulated_data_dir()
simulated_data_dir
str_c(simulated_data_dir, "03 metagenomics combined/")
"/Users/laurasymul/OneDrive - UCL/Academia/Research/VIBRANT data UCLouvain/simulated data/2025-03-27/03 metagenomics combined/mg_combined.csv"
counts <- read_csv(str_c(mg_dir, "mg_combined.csv"))
simulated_data_dir <- get_simulated_data_dir()
mg_dir <- str_c(simulated_data_dir, "03 metagenomics combined/")
counts <- read_csv(str_c(mg_dir, "mg_combined.csv"))
counts
read_csv(str_c(mg_dir, "manifest.csv"))
manifest <- read_csv(str_c(mg_dir, "mg_combined_manifest.csv"))
manifest
mg_manifest <-
mg_manifest |>
mutate(sample_id = str_c(pid, "_", visit_code)) # nécéssaire ? pourquoi pas "barcode" ccréer dans sim ?
mg_manifest <-
mg_manifest |>
mutate(sample_id = str_c(pid, "_", visit_code))
mg_manifest <- manifest
mg_manifest <-
mg_manifest |>
mutate(sample_id = str_c(pid, "_", visit_code))
mg_manifest
if (any(duplicated(mg_manifest$sample_id))) stop("Duplicated `uid` in `mg_manifest`")
mg
counts
counts <- counts |> left_join(mg_manifest, by = join_by(barcode))
counts
tmp <- mg |> dplyr::select(barcode, sample_id) |> distinct()
tmp <- counts |> dplyr::select(barcode, sample_id) |> distinct()
if (any(duplicated(tmp$sample_id))) stop("Duplicated `uid` in `mg`")
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode)) |> colnames()
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode, total_reads)) |> colnames()
assay_counts <-
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode, total_reads)) |>
as.data.frame() |>
column_to_rownames("sample_id") |>
t()
assay_counts
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode, total_reads)) |>
as.data.frame() |>
column_to_rownames("sample_id") |> dim()
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode, total_reads)) |>
as.data.frame() |>
column_to_rownames("sample_id") |>
drop_na() |> dim()
assay_counts <-
counts |>
dplyr::select(sample_id, everything()) |>
dplyr::select(-c(pid, visit_code, barcode, total_reads)) |>
as.data.frame() |>
column_to_rownames("sample_id") |>
drop_na() |>
t()
assay_counts
assay_counts |> dim()
assay_counts |> colSums()
all(counts$total_reads == colSums(assay_counts))
all(counts$total_reads[!is.na(counts$total_reads)] == colSums(assay_counts))
plot(counts$total_reads[!is.na(counts$total_reads)], colSums(assay_counts))
assay_counts
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
)
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, total_reads)
)
?drop_na
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, total_reads)
) |>
ggplot() +
aes(x = sum_counts, y = total_reads) +
geom_point()
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, total_reads),
by = join_by(sample_id)
) |>
ggplot() +
aes(x = sum_counts, y = total_reads) +
geom_abline(slope = 1, intercept = 0) +
geom_point()
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, total_reads),
by = join_by(sample_id)
) |>
ggplot() +
aes(x = sum_counts, y = total_reads) +
geom_abline(slope = 1, intercept = 0) +
geom_point(alpha = 0.5)
## Checking if total_reads match the sum accross taxa
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, total_reads),
by = join_by(sample_id)
) |>
ggplot() +
aes(x = sum_counts, y = total_reads) +
geom_abline(slope = 1, intercept = 0, col = "steelblue1") +
geom_point(alpha = 0.5, size = 0.3)
(t(assay_counts)/colSums(assay_counts)) |>
t() |> colSums()
mg |>
dplyr::select(sample_id, barcode)
counts |>
dplyr::select(sample_id, barcode) |> #shared_kmers
distinct() |>
as.data.frame()
se_coldata <-
counts |>
dplyr::select(sample_id, barcode) |> #shared_kmers
distinct() |>
as.data.frame()
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(counts |> select(sample_id, barcode, total_reads))
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, barcode, total_reads), by = join_by(sample_id)
)
se_coldata <-
tibble(
sample_id = colnames(assay_counts),
sum_counts = colSums(assay_counts)
) |>
left_join(
counts |> select(sample_id, barcode, total_reads), by = join_by(sample_id)
) |>
select(barcode, everything()) |>
as.data.frame() |>
column_to_rownames("sample_id")
