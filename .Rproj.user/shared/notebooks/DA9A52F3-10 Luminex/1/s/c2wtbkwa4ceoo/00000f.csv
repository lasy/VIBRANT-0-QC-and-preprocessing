"0",""
"0","plot_marginals <- function(raw, by = ""plate_nb"", binwidth = 1){"
"0","  tmp <- raw |> as_tibble()"
"0","  tmp <- tmp |> bind_rows(tmp |> mutate(.feature = ""all analytes""))"
"0","  tmp$by <- str_c(by ,"" "", tmp[[by]])"
"0","  "
"0","  min_c <- min(tmp$conc_log2[!is.infinite(tmp$conc_log2)], na.rm = TRUE)"
"0","  max_c <- max(tmp$conc_log2[!is.infinite(tmp$conc_log2)], na.rm = TRUE)"
"0",""
"0","  tmp |> "
"0","    mutate("
"0","      conc_log2_bin = "
"0","        conc_log2 |> "
"0","        cut(breaks = seq(min_c, max_c, by = binwidth))"
"0","    ) |> "
"0","    dplyr::count(by, .feature, conc_log2_bin) |>"
"0","    group_by(by, .feature) |> "
"0","    mutate(f = n/sum(n)) |> "
"0","    ggplot( ) +"
"0","    aes(x = conc_log2_bin, y = by, fill = by, alpha = f) +"
"0","    geom_tile() +"
"0","    facet_wrap(.feature ~ ., scale = ""free"") +"
"0","    labs("
"0","      x = ""log2(concentration)\n(independent scales per analyte)"","
"0","      y = by"
"0","    ) +"
"0","    scale_x_discrete(breaks = NULL) +"
"0","    guides(fill = ""none"") +"
"0","    theme(strip.text.y = element_text(angle = 0))"
"0","  "
"0","}"
